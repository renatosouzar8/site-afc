<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AFC - Site Oficial</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;900&family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --primary:#e5093a; --primary-600:#c3072f; --bg:#0e0f12; --surface:#15161b;
      --surface-2:rgba(255,255,255,.06); --text:#e7e7ea; --muted:#a9a9b3;
      --accent:#ffd66d; --info:#3b82f6; --border:rgba(255,255,255,.12);
      --glass:rgba(255,255,255,.04); --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--text);
      font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(229,9,58,.2), transparent 60%),
        radial-gradient(1000px 600px at 90% 10%, rgba(255,214,109,.1), transparent 60%),
        var(--bg);
      padding-top:120px;
    }

    header{
      position:fixed; inset:0 0 auto 0; z-index:1000;
      backdrop-filter:saturate(140%) blur(10px);
      background:linear-gradient(180deg, rgba(14,15,18,.8), rgba(14,15,18,.5));
      border-bottom:1px solid var(--border);
    }
    .header-inner{max-width:1100px;margin:0 auto;padding:14px 20px 6px;display:flex;flex-direction:column;align-items:center;gap:10px}
    .logo-bar{width:100%;display:flex;align-items:center;justify-content:center;gap:14px}
    .logo-bar img{height:54px;border-radius:8px;filter:drop-shadow(0 6px 12px rgba(229,9,58,.25))}
    .logo-bar h1{
      margin:0;font-family:'Outfit',sans-serif;font-weight:900;letter-spacing:.5px;font-size:2rem;
      background:linear-gradient(90deg,#fff,#ffd66d 45%,#fff 90%);-webkit-background-clip:text;background-clip:text;color:transparent;
      text-shadow:0 8px 30px rgba(255,214,109,.15);
    }

    nav{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;width:100%;padding:8px;border-top:1px solid var(--border)}
    nav .menu-item, nav .admin-btn{
      border:1px solid var(--border); background:var(--glass); color:var(--text);
      font-family:'Outfit',sans-serif;font-weight:700;letter-spacing:.4px;text-transform:uppercase;
      font-size:.85rem;padding:10px 16px;border-radius:999px;cursor:pointer;
      transition:transform .15s, background .2s, border-color .2s;
      text-decoration: none;
    }
    nav .menu-item:hover{background:rgba(255,255,255,.08);transform:translateY(-1px)}
    nav .menu-item.active{background:linear-gradient(180deg,var(--primary),var(--primary-600));border-color:transparent;box-shadow:0 8px 20px rgba(229,9,58,.35);color:#fff}
    nav .admin-btn{background:linear-gradient(180deg,#6e5d12,#5b4c0e);border-color:rgba(255,214,109,.2);color:#fff}

    main{max-width:1100px;margin:20px auto;padding:0 20px 60px}
    section{display:none}
    section.active{display:block;animation:fadeIn .45s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

    h2{
      font-family:'Outfit',sans-serif;font-weight:900;letter-spacing:.2px;font-size:2rem;text-align:center;margin:0 0 22px;
      background:linear-gradient(90deg,#fff,#ffd66d 60%,#fff);-webkit-background-clip:text;background-clip:text;color:transparent;
    }
    h3{font-family:'Outfit',sans-serif;font-weight:700;font-size:1.2rem;margin:0 0 16px;color:#fff;display:flex;align-items:center;gap:10px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid var(--border);border-radius:var(--radius);padding:22px;box-shadow:var(--shadow)}

    #home-card{
      position:relative;text-align:center;padding:36px 22px;overflow:hidden;
      background:linear-gradient(rgba(12,12,16,.75),rgba(12,12,16,.85)), url('galeria/escudo-afc.png') center/220px no-repeat;
    }
    #home-card .welcome-title{font-family:'Outfit',sans-serif;font-size:2rem;font-weight:900;margin-bottom:10px}
    #home-card .welcome-text{color:var(--muted);font-size:1.05rem;max-width:640px;margin:0 auto 22px}

    table{width:100%;border-collapse:collapse;margin-top:12px;overflow:clip;border-radius:10px}
    thead th{
      position:sticky;top:0;background:linear-gradient(180deg,var(--primary),var(--primary-600));
      color:#fff;font-family:'Outfit',sans-serif;font-weight:800;text-transform:uppercase;font-size:.85rem;letter-spacing:.4px;padding:14px;text-align:center;
    }
    tbody td{padding:14px;text-align:center;background:rgba(255,255,255,.03);border-bottom:1px solid var(--border)}
    tbody tr:nth-child(even) td{background:rgba(255,255,255,.045)}
    tbody tr:hover td{background:rgba(229,9,58,.12)}

    .card-list{display:grid;gap:12px}
    .item-card{display:grid;gap:8px;background:var(--surface-2);border:1px solid var(--border);border-radius:12px;padding:14px;transition:transform .15s, background .2s, border-color .2s}
    .item-card:hover{transform:translateY(-2px);background:rgba(255,255,255,.07);border-color:rgba(229,9,58,.35)}
    .item-title{font-weight:800}
    .item-sub{color:var(--muted);font-size:.95rem}

    .posicoes-grid{display:grid;gap:16px;grid-template-columns:repeat(3,1fr)}
    @media (max-width:1000px){.posicoes-grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){.posicoes-grid{grid-template-columns:1fr}}

    .posicao-card{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border:1px solid var(--border);border-radius:12px;padding:16px}
    .posicao-title{margin:0 0 12px;font-family:'Outfit',sans-serif;font-weight:900;letter-spacing:.3px}
    .jogadores-grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(180px,1fr))}
    .jogador-card{background:var(--surface-2);border:1px solid var(--border);border-radius:12px;overflow:hidden;transition:transform .15s, background .2s, border-color .2s}
    .jogador-card:hover{transform:translateY(-2px);background:rgba(255,255,255,.07);border-color:rgba(229,9,58,.35)}
    .jogador-thumb{width:100%;aspect-ratio:4/3;object-fit:cover;display:block;background:#0b0c10}
    .jogador-info{padding:10px}
    .jogador-nome{font-weight:800}
    .jogador-posicao{color:var(--muted);font-size:.9rem}

    .stats-row{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));margin-bottom:6px}
    .stat-box{background:var(--surface-2);border:1px solid var(--border);border-radius:12px;padding:18px;text-align:center;transition:transform .15s, background .2s, border-color .2s}
    .stat-box:hover{transform:translateY(-2px);background:rgba(255,255,255,.07);border-color:rgba(229,9,58,.35)}
    .stat-number{font-family:'Outfit',sans-serif;font-size:2rem;font-weight:900;color:var(--accent)}
    .stat-label{font-size:.85rem;text-transform:uppercase;color:var(--muted)}

    .bar-chart{margin-top:16px;background:var(--surface-2);border:1px solid var(--border);border-radius:12px;padding:16px}
    .bar-chart h4{margin:0 0 10px;font-family:'Outfit',sans-serif}
    .bar-chart-row{display:grid;grid-template-columns:140px 1fr;gap:12px;align-items:center;margin-bottom:12px}
    .bar-chart-label{font-weight:700;color:#fff;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .bar-container{display:flex;flex-direction:column;gap:6px}
    .bar-item{display:flex;align-items:center;gap:8px}
    .bar-track{flex-grow:1;height:12px;background:rgba(255,255,255,.08);border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .bar-fill{height:100%;width:0;transition:width .6s;border-radius:999px}
    .bar-fill-goals{background:linear-gradient(90deg,var(--primary),var(--primary-600))}
    .bar-fill-assists{background:linear-gradient(90deg,var(--info),#2563eb)}
    .bar-value{font-size:.85rem;color:var(--muted);min-width:80px}

    .gallery-card{margin-top:16px}
    .gallery-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
    .gallery-item{position:relative;overflow:hidden;border-radius:12px;border:1px solid var(--border);background:var(--surface-2);cursor:zoom-in}
    .gallery-item img{width:100%;height:180px;object-fit:cover;display:block;transition:transform .3s, filter .3s}
    .gallery-item:hover img{transform:scale(1.04);filter:brightness(1.05)}

    .lightbox{display:none;position:fixed;inset:0;z-index:3000;background:rgba(0,0,0,.75);backdrop-filter:blur(4px);align-items:center;justify-content:center;padding:20px}
    .lightbox.open{display:flex}
    .lightbox img{max-width:95vw;max-height:85vh;border-radius:12px;border:1px solid var(--border);box-shadow:var(--shadow)}
    .lightbox .close{position:absolute;top:14px;right:14px;background:var(--glass);color:#fff;border:1px solid var(--border);border-radius:999px;padding:8px 12px;cursor:pointer}

    @media (max-width:768px){
      table{display:none}
      .table-as-cards{display:grid;gap:12px}
      #home-card{background-size:160px}
    }

    .player-modal-overlay{display:none;position:fixed;inset:0;z-index:4000;background:rgba(0,0,0,.7);backdrop-filter:blur(4px);align-items:center;justify-content:center}
    .player-modal-overlay.open{display:flex}
    .player-modal-content{position:relative;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:24px;width:92%;max-width:400px;text-align:center;animation:fadeIn .3s ease}
    .player-modal-close{position:absolute;top:10px;right:10px;background:var(--glass);color:#fff;border:1px solid var(--border);border-radius:999px;padding:6px 10px;cursor:pointer}
    #player-modal-img{width:120px;height:120px;object-fit:cover;border-radius:50%;border:4px solid var(--primary);margin-bottom:16px;background:#0b0c10}
    #player-modal-name{font-family:'Outfit',sans-serif;font-size:1.8rem;margin-bottom:12px}
    #player-modal-details{display:grid;grid-template-columns:1fr 1fr;gap:12px;text-align:left}
    #player-modal-details .detail-item{background:var(--surface-2);padding:12px;border-radius:10px;border:1px solid var(--border)}
    #player-modal-details .detail-label{font-size:.8rem;color:var(--muted);text-transform:uppercase;margin-bottom:4px}
    #player-modal-details .detail-value{font-family:'Outfit',sans-serif;font-size:1.2rem;font-weight:700;color:#fff}
    .jogador-card .details-btn{margin-top:8px;width:calc(100% - 20px);margin-left:10px;margin-right:10px;margin-bottom:10px;padding:8px;background:var(--primary-600);color:#fff;border:none;border-radius:8px;font-weight:700;cursor:pointer;transition:background .2s}
    .jogador-card .details-btn:hover{background:var(--primary)}
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="logo-bar">
        <img src="galeria/escudo-afc.png" alt="AFC Escudo">
        <h1>AFC</h1>
      </div>
      <nav>
        <button class="menu-item active" data-tab="home">Início</button>
        <button class="menu-item" data-tab="jogadores">Jogadores</button>
        <button class="menu-item" data-tab="calendario">Calendário</button>
        <button class="menu-item" data-tab="historico">Histórico</button>
        <button class="menu-item" data-tab="estatisticas">Estatísticas</button>
        <a href="admin.html" class="admin-btn">⚙️ Admin</a>
      </nav>
    </div>
  </header>

  <main>
    <section id="home" class="active">
      <div id="home-card" class="card">
        <div class="welcome-title">⚽ Bem-vindos à página dos amigos da AFC</div>
        <div class="welcome-text">Amigos da AFC é mais que um clube, é uma família unida pela paixão do futebol.</div>
        <div id="home-next-game"></div>
      </div>

      <div class="card gallery-card">
        <h3>Fotos do Grupo</h3>
        <div class="gallery-grid" id="gallery-grid"></div>
        <div id="gallery-msg" class="item-sub" style="margin-top:6px"></div>
      </div>
    </section>

    <section id="jogadores">
      <h2>Elenco</h2>
      <div class="card">
        <div id="jogadores-por-posicao" class="posicoes-grid"></div>
      </div>
    </section>

    <section id="calendario">
      <h2>Calendário de Jogos</h2>
      <div class="card">
        <div id="calendario-cards" class="card-list"></div>
        <table id="calendario-table">
          <thead><tr><th>Próximos confrontos</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section id="historico">
      <h2>Histórico de Confrontos</h2>
      <div class="card" id="historico-filtro">
        <h3>Retrospecto por Adversário</h3>
        <label for="adversario-select">Selecione o Adversário:</label>
        <select id="adversario-select"></select>
        <div id="historico-resumo"></div>
      </div>
      <div class="card">
        <h3>Jogos Realizados</h3>
        <div id="historico-passados-cards" class="card-list table-as-cards"></div>
        <table id="historico-jogos-passados-table">
          <thead><tr><th>Data</th><th>Adversário</th><th>Resultado</th><th>Detalhes</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section id="estatisticas">
      <h2>Estatísticas</h2>
      <div class="card">
        <h3>Desempenho Geral do Time</h3>
        <div class="stats-row" id="estatisticas-gerais"></div>
      </div>
      <div class="card">
        <h3>Artilharia e Assistências</h3>
        <table id="estatisticas-jogadores-table">
          <thead><tr><th>Jogador</th><th>Posição</th><th>Gols</th><th>Assistências</th></tr></thead>
          <tbody></tbody>
        </table>
        <div class="bar-chart" id="grafico-barras">
          <h4>Gols e Assistências por Jogador</h4>
          <div id="bars-container"></div>
        </div>
      </div>
    </section>
  </main>

  <div id="player-modal" class="player-modal-overlay">
    <div class="player-modal-content">
      <button id="player-modal-close" class="player-modal-close">✕</button>
      <img id="player-modal-img" src="" alt="Foto do Jogador">
      <h3 id="player-modal-name"></h3>
      <div id="player-modal-details"></div>
    </div>
  </div>

  <div class="lightbox" id="lightbox">
    <button class="close" id="lightbox-close">Fechar ✕</button>
    <img id="lightbox-img" src="" alt="Foto ampliada" />
  </div>

  <script>
    const STORAGE_KEY = 'afc_site_data_v1';
    const ESCUDO = 'galeria/escudo-afc.png';
    const REMOTE_JSON = 'dados_afc.json';

    const initialData = {
      jogadores: [],
      calendario: [],
      galeria: []
    };

    function saveToStorage(data){try{localStorage.setItem(STORAGE_KEY,JSON.stringify(data))}catch(e){}}
    function loadFromStorage(){try{const s=localStorage.getItem(STORAGE_KEY);return s?JSON.parse(s):null}catch(e){return null}}

    function normalizeData(d){
      return {
        jogadores: Array.isArray(d?.jogadores) ? d.jogadores : [],
        calendario: Array.isArray(d?.calendario) ? d.calendario : [],
        galeria: Array.isArray(d?.galeria) ? d.galeria : initialData.galeria
      };
    }

    let siteData = normalizeData(loadFromStorage() || initialData);

    async function loadData(){
      try{
        const res = await fetch(REMOTE_JSON, {cache:'no-store'});
        if(!res.ok) throw new Error('HTTP '+res.status);
        const remote = await res.json();
        siteData = normalizeData(remote);
        saveToStorage(siteData);
      }catch(err){
        console.warn('Falha ao buscar dados remotos:', err);
        const local = loadFromStorage();
        siteData = normalizeData(local || initialData);
        if(!local) saveToStorage(siteData);
      }
    }

    const DESKTOP_CARDS_CALENDARIO = true;
    function isMobile(){return window.matchMedia('(max-width: 768px)').matches}

    function renderHome(){
      const nextGameContainer=document.getElementById('home-next-game');

      const today = new Date();
      today.setHours(0, 0, 0, 0);

      const proximosJogos=siteData.calendario.filter(j => {
        const gameDate = new Date(j.data + 'T00:00:00');
        return gameDate >= today;
      }).sort((a,b)=>new Date(a.data)-new Date(b.data));

      if(proximosJogos.length>0){
        const proximoJogo=proximosJogos[0];
        const dataFormatada=new Date(proximoJogo.data+'T00:00:00').toLocaleDateString('pt-BR',{weekday:'long', day:'2-digit', month:'long'});
        nextGameContainer.innerHTML=`
          <h4>Próximo Confronto</h4>
          <div class="match">
            <div class="teams">AFC x ${proximoJogo.adversario}</div>
            <div class="date-badge">📅 ${dataFormatada}</div>
            <div class="countdown" id="countdown-next">Carregando...</div>
          </div>`;
        const target=new Date(proximoJogo.data+'T00:00:00').getTime();
        const el=document.getElementById('countdown-next');
        const tick=()=>{const diff=target-Date.now();
          if(diff<=0){el.textContent='É dia de jogo!';clearInterval(timer);return}
          const d=Math.floor(diff/86400000); const h=Math.floor((diff%86400000)/3600000);
          el.textContent=`Faltam ${d}d ${h}h`;
        };
        const timer=setInterval(tick,60000); tick();
      }else{
        nextGameContainer.innerHTML=`<h4>Fim de Temporada!</h4><p class="match">Aguarde o calendário do próximo ano.</p>`;
      }
    }

    const MAP_POS = {'Goleiro':'Goleiros','Zagueiro':'Zagueiros','Lateral':'Laterais','Volante':'Volantes','Meia':'Meias','Atacante':'Atacantes'};
    function renderJogadoresPorPosicao(){
      const container = document.getElementById('jogadores-por-posicao');
      container.innerHTML = '';
      const grupos = {};
      siteData.jogadores.forEach(j => {
        const key = MAP_POS[j.posicao] || j.posicao || 'Outros';
        if(!grupos[key]) grupos[key] = [];
        grupos[key].push(j);
      });
      const ordem = ['Goleiros','Zagueiros','Laterais','Volantes','Meias','Atacantes'];
      const chaves = Object.keys(grupos).sort((a,b)=> (ordem.indexOf(a)===-1?999:ordem.indexOf(a)) - (ordem.indexOf(b)===-1?999:ordem.indexOf(b)));

      chaves.forEach(posTitulo => {
        const box = document.createElement('div');
        box.className = 'posicao-card';
        box.innerHTML = `<h3 class="posicao-title">${posTitulo}</h3><div class="jogadores-grid"></div>`;
        const grid = box.querySelector('.jogadores-grid');

        grupos[posTitulo].forEach(j => {
          const foto = (j.foto && j.foto.trim()) ? j.foto.trim() : ESCUDO;
          const card = document.createElement('div');
          card.className = 'jogador-card';
          const img = document.createElement('img');
          img.className = 'jogador-thumb';
          img.src = foto;
          img.alt = j.nome;
          img.onerror = ()=>{ if(img.src !== ESCUDO) img.src = ESCUDO; };
          const info = document.createElement('div');
          info.className = 'jogador-info';
          info.innerHTML = `<div class="jogador-nome">${j.nome}</div><div class="jogador-posicao">${j.posicao}</div>`;

          const detailsBtn = document.createElement('button');
          detailsBtn.className = 'details-btn';
          detailsBtn.textContent = 'Detalhes';
          detailsBtn.onclick = () => openPlayerModal(j);

          card.appendChild(img);
          card.appendChild(info);
          card.appendChild(detailsBtn);
          grid.appendChild(card);
        });

        container.appendChild(box);
      });
    }

    function openPlayerModal(player) {
      const modal = document.getElementById('player-modal');
      if (!modal || !player) return;

      document.getElementById('player-modal-img').src = (player.foto && player.foto.trim()) ? player.foto.trim() : ESCUDO;
      document.getElementById('player-modal-img').onerror = () => { document.getElementById('player-modal-img').src = ESCUDO; };
      document.getElementById('player-modal-name').textContent = player.nome;

      const detailsContainer = document.getElementById('player-modal-details');
      detailsContainer.innerHTML = `
        <div class="detail-item">
          <div class="detail-label">Posição</div>
          <div class="detail-value">${player.posicao || '-'}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">Idade</div>
          <div class="detail-value">${player.idade || '-'}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">Gols</div>
          <div class="detail-value">${player.gols}</div>
        </div>
        <div class="detail-item">
          <div class="detail-label">Assistências</div>
          <div class="detail-value">${player.assistencias}</div>
        </div>
      `;

      modal.classList.add('open');
    }
    function closePlayerModal() {
      const modal = document.getElementById('player-modal');
      if (modal) modal.classList.remove('open');
    }

    function renderCalendario(){
      const tbody=document.querySelector('#calendario-table tbody');
      const cards=document.getElementById('calendario-cards');
      tbody.innerHTML=''; cards.innerHTML='';

      const today = new Date();
      today.setHours(0, 0, 0, 0);

      const proximosJogos=siteData.calendario.filter(j => {
        const gameDate = new Date(j.data + 'T00:00:00');
        return gameDate >= today;
      }).sort((a,b)=>new Date(a.data)-new Date(b.data));

      const usarCards=isMobile()||DESKTOP_CARDS_CALENDARIO;
      proximosJogos.forEach(j=>{
        const dataFormatada=new Date(j.data+'T00:00:00').toLocaleDateString('pt-BR');
        if(usarCards){
          const div=document.createElement('div'); div.className='item-card';
          div.innerHTML=`<div class="item-title">AFC x ${j.adversario}</div><div class="item-sub">📅 ${dataFormatada}</div>`;
          cards.appendChild(div);
        }else{
          tbody.innerHTML+=`<tr><td>${dataFormatada} – AFC x ${j.adversario}</td></tr>`;
        }
      });
      document.getElementById('calendario-table').style.display=usarCards?'none':'table';
      cards.style.display=usarCards?'grid':'none';
    }

    function getHistoricoData(){
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      const jogosPassados=siteData.calendario.filter(j => {
        const gameDate = new Date(j.data + 'T00:00:00');
        return gameDate < today;
      }).map(j=>{
        if(!j.resultado || !j.resultado.includes('x')) return {...j,golsAFC:0,golsAdv:0};
        const [gA,gB]=j.resultado.split('x').map(Number); return {...j,golsAFC:gA,golsAdv:gB};
      });
      const statsPorAdv={};
      jogosPassados.forEach(j=>{
        if(!statsPorAdv[j.adversario]) statsPorAdv[j.adversario]={j:0,v:0,e:0,d:0,gp:0,gc:0};
        const s=statsPorAdv[j.adversario];
        s.j++; s.gp+=j.golsAFC; s.gc+=j.golsAdv;
        if(j.golsAFC>j.golsAdv) s.v++; else if(j.golsAFC<j.golsAdv) s.d++; else s.e++;
      });
      return {jogosPassados,statsPorAdv};
    }
    function renderHistorico(){
      const {jogosPassados,statsPorAdv}=getHistoricoData();
      const select=document.getElementById('adversario-select');
      const resumoDiv=document.getElementById('historico-resumo');
      const tbody=document.querySelector('#historico-jogos-passados-table tbody');
      const cards=document.getElementById('historico-passados-cards');

      select.innerHTML='<option value="">-- Escolha um time --</option>';
      resumoDiv.innerHTML=''; tbody.innerHTML=''; cards.innerHTML='';

      Object.keys(statsPorAdv).sort().forEach(adv=>{select.innerHTML+=`<option value="${adv}">${adv}</option>`;});

      jogosPassados.sort((a,b)=>new Date(b.data)-new Date(a.data));
      const usarCards=isMobile();
      jogosPassados.forEach(j=>{
        const dataFormatada=new Date(j.data+'T00:00:00').toLocaleDateString('pt-BR');
        if(usarCards){
          const div=document.createElement('div'); div.className='item-card';
          div.innerHTML=`<div class="item-title">${dataFormatada} • ${j.resultado}</div>
                         <div class="item-sub">Adversário: ${j.adversario}</div>
                         <div class="item-sub">${j.detalhes||'-'}</div>`;
          cards.appendChild(div);
        }else{
          tbody.innerHTML+=`<tr><td>${dataFormatada}</td><td>${j.adversario}</td><td>${j.resultado}</td><td>${j.detalhes||'-'}</td></tr>`;
        }
      });
      document.getElementById('historico-jogos-passados-table').style.display=usarCards?'none':'table';
      cards.style.display=usarCards?'grid':'none';

      select.onchange=function(){
        const adversario=this.value; if(!adversario){resumoDiv.innerHTML='';return;}
        const s=statsPorAdv[adversario];
        resumoDiv.innerHTML=`
          <div class="stats-row">
            <div class="stat-box"><div class="stat-number">${s.j}</div><div class="stat-label">Jogos</div></div>
            <div class="stat-box"><div class="stat-number">${s.v}</div><div class="stat-label">Vitórias</div></div>
            <div class="stat-box"><div class="stat-number">${s.e}</div><div class="stat-label">Empates</div></div>
            <div class="stat-box"><div class="stat-number">${s.d}</div><div class="stat-label">Derrotas</div></div>
            <div class="stat-box"><div class="stat-number">${s.gp}</div><div class="stat-label">Gols Marcados</div></div>
            <div class="stat-box"><div class="stat-number">${s.gc}</div><div class="stat-label">Gols Sofridos</div></div>
          </div>`;
      };
    }

    function renderEstatisticas(){
      const {jogosPassados}=getHistoricoData();
      const v=jogosPassados.filter(j=>j.golsAFC>j.golsAdv).length;
      const e=jogosPassados.filter(j=>j.golsAFC===j.golsAdv).length;
      const d=jogosPassados.filter(j=>j.golsAFC<j.golsAdv).length;
      const gp=jogosPassados.reduce((a,j)=>a+j.golsAFC,0);
      const gc=jogosPassados.reduce((a,j)=>a+j.golsAdv,0);

      document.getElementById('estatisticas-gerais').innerHTML=
        `<div class="stat-box"><div class="stat-number">${v}</div><div class="stat-label">Vitórias</div></div>
         <div class="stat-box"><div class="stat-number">${e}</div><div class="stat-label">Empates</div></div>
         <div class="stat-box"><div class="stat-number">${d}</div><div class="stat-label">Derrotas</div></div>
         <div class="stat-box"><div class="stat-number">${gp}</div><div class="stat-label">Gols Marcados</div></div>
         <div class="stat-box"><div class="stat-number">${gc}</div><div class="stat-label">Gols Sofridos</div></div>`;

      const tbody=document.querySelector('#estatisticas-jogadores-table tbody');
      tbody.innerHTML='';
      const jogadoresComStats=siteData.jogadores.filter(j=>j.gols>0||j.assistencias>0)
        .sort((a,b)=>(b.gols+b.assistencias)-(a.gols+a.assistencias));
      jogadoresComStats.forEach(j=>{
        tbody.innerHTML+=`<tr><td>${j.nome}</td><td>${j.posicao}</td><td>${j.gols}</td><td>${j.assistencias}</td></tr>`;
      });
      renderBarChart(jogadoresComStats);
    }
    function renderBarChart(jogadores){
      const c=document.getElementById('bars-container'); c.innerHTML='';
      if(!jogadores.length){c.innerHTML='<div class="item-sub">Sem dados de gols/assistências no momento.</div>';return;}

      const maxGoals = Math.max(...jogadores.map(j => j.gols), 1);
      const maxAssists = Math.max(...jogadores.map(j => j.assistencias), 1);

      jogadores.forEach(j=>{
        const row = document.createElement('div');
        row.className = 'bar-chart-row';

        row.innerHTML = `
          <div class="bar-chart-label">${j.nome}</div>
          <div class="bar-container">
            <div class="bar-item">
              <div class="bar-track">
                <div class="bar-fill bar-fill-goals"></div>
              </div>
              <div class="bar-value">Gols: <strong>${j.gols}</strong></div>
            </div>
            <div class="bar-item">
              <div class="bar-track">
                <div class="bar-fill bar-fill-assists"></div>
              </div>
              <div class="bar-value">Assist.: <strong>${j.assistencias}</strong></div>
            </div>
          </div>
        `;

        c.appendChild(row);

        requestAnimationFrame(()=>{
          const goalFill = row.querySelector('.bar-fill-goals');
          const assistFill = row.querySelector('.bar-fill-assists');
          if (goalFill) {
            goalFill.style.width = Math.round((j.gols / maxGoals) * 100) + '%';
          }
          if (assistFill) {
            assistFill.style.width = Math.round((j.assistencias / maxAssists) * 100) + '%';
          }
        });
      });
    }

    function renderGaleria(){
      const grid=document.getElementById('gallery-grid');
      const msg=document.getElementById('gallery-msg');
      if(!grid) return;
      grid.innerHTML=''; msg.textContent='';

      const items=Array.isArray(siteData.galeria)?siteData.galeria:[];
      if(!items.length){msg.textContent='Ainda não há fotos na galeria.';return;}

      items.forEach(item=>{
        const div=document.createElement('div'); div.className='gallery-item';
        const img=document.createElement('img');
        img.alt=item.alt||'Foto do grupo';
        let tried=false;
        img.onerror=()=>{
          if(!tried){
            tried=true;
            img.src = (item.src||'') + (item.src?.includes('?') ? '&' : '?') + 't=' + Date.now();
          }else{
            img.src=ESCUDO;
          }
        };
        img.src=item.src;
        div.appendChild(img);
        div.addEventListener('click',()=>openLightbox(img.src,img.alt));
        grid.appendChild(div);
      });
    }

    function openLightbox(src,alt){
      const lb=document.getElementById('lightbox'); const img=document.getElementById('lightbox-img');
      img.src=src; img.alt=alt||'Foto ampliada'; lb.classList.add('open');
    }
    function closeLightbox(){const lb=document.getElementById('lightbox'); const img=document.getElementById('lightbox-img'); img.src=''; lb.classList.remove('open')}
    document.getElementById('lightbox').addEventListener('click',(e)=>{if(e.target.id==='lightbox'||e.target.id==='lightbox-close') closeLightbox()});
    document.addEventListener('keydown',(e)=>{if(e.key==='Escape') closeLightbox()});

    async function initSiteAsync(){
      await loadData();
      renderHome();
      renderJogadoresPorPosicao();
      renderCalendario();
      renderHistorico();
      renderEstatisticas();
      renderGaleria();

      const playerModal = document.getElementById('player-modal');
      const playerModalCloseBtn = document.querySelector('.player-modal-close');
      if (playerModal) {
        playerModal.addEventListener('click', (e) => {
          if (e.target.id === 'player-modal') closePlayerModal();
        });
      }
      if (playerModalCloseBtn) {
        playerModalCloseBtn.addEventListener('click', closePlayerModal);
      }
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && playerModal?.classList.contains('open')) {
          closePlayerModal();
        }
      });
    }
    document.addEventListener('DOMContentLoaded',initSiteAsync);

    document.querySelectorAll('nav .menu-item').forEach(btn=>btn.addEventListener('click',()=>{
      document.querySelectorAll('main section').forEach(sec=>sec.classList.remove('active'));
      document.getElementById(btn.dataset.tab).classList.add('active');
      document.querySelectorAll('nav .menu-item').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      if(btn.dataset.tab==='jogadores') renderJogadoresPorPosicao();
      if(btn.dataset.tab==='calendario') renderCalendario();
      if(btn.dataset.tab==='historico') renderHistorico();
      if(btn.dataset.tab==='estatisticas') renderEstatisticas();
      if(btn.dataset.tab==='home') renderGaleria();
    }));

    window.addEventListener('resize',()=>{
      const current=document.querySelector('section.active')?.id; if(!current) return;
      if(current==='jogadores') renderJogadoresPorPosicao();
      if(current==='calendario') renderCalendario();
      if(current==='historico') renderHistorico();
    });

    window.addEventListener('error', (e) => {
      const t = e.target;
      if (t && t.tagName === 'IMG') console.warn('Falha ao carregar imagem:', t.src);
    }, true);
  </script>
</body>
</html>
